language: go
go:
- 1.11.x
before_install:
- go get github.com/mitchellh/gox
- go get github.com/gobuffalo/packr/packr
- packr
install:
- go get -t -v ./...
script:
- diff -u <(echo -n) <(gofmt -d .)
- go vet $(go list ./... | grep -v /vendor/)
- go test -v -race ./...
- gox -osarch="linux/arm linux/amd64 windows/amd64 darwin/amd64" -output="apw.{{.OS}}.{{.Arch}}"
  -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: "dIpHohtygQ1yllSnVGFVucEvCJ1HaotUI7EtGy0N+/5QW4sMEVkk9s6G0LPcqcCkBtz1D0CH+ySEtOGsszQUv+iIq3OpiNNH+f55ZVnVe5um6oL85x5M7nYAv2cr3PcMsEX8H7sjVhvrOxn3tlqTvoOFzUVKvmFH78rwWP9gOkkEa4dMJl2tNf/5HfBqtmiKmNbLXqKtBHgLWutUwKNgA1T0Z+EmXnFjgGDok8a1L+6U9KeycVJsOZiyXAxSwoXSsVaQG7WWELL5inws9WoxW6DhekYUWZQqy2ZgyRowvRYXblZu+RWPb5x1yKOeT3qZ1LljSiTcemTjyXhQUpyN/HqYe6pQtXj/IhWOrEot7tPH9sVOBpAhRQrWYLtsVwKvYE1upWtndSJTR/J3Eh3guvlH2m+1T9Xv0eFAsgd3bUyIPS7Bq/iJhz9yiptThvb2+E6tKxcNnvgKyzTa7l7rWO3h+M7j3ZW+mm2mLCB9IqRonAk0jNYPVFJVLcqiFYqimHcLmk4T6UAUsI3KJj2ATXY9TZh93KMX+t0ysFho5GugvogEldWOk8Qw1PvZ71Vr8srP1lh5rRiLz+VDhYUVMSruvJyxkLmSYq/7ZHa7ZhKjz8IUBpz2pDtUngrqwo/wa7gyHwYUP9BIfp+bqkzfmwbCg6ZEY0InWUj600ftfo8="  
  file: 
  - apw.windows.amd64.exe
  - apw.darwin.amd64
  - apw.linux.amd64
  - apw.linux.arm
  on:
    tags: true
    repo: nilbelec/amazon-price-watcher
